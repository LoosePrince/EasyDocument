# path.json 结构与手动编写

本文档详细说明 EasyDocument 系统中 `path.json` 文件的结构及如何手动编辑它。虽然 EasyDocument 提供了 `build.py` 脚本来自动生成 `path.json`，但在某些情况下，手动编辑可以提供更精确的控制，例如自定义文档排序或添加特殊导航结构。

## path.json 的作用

`path.json` 是 EasyDocument 系统的核心配置文件之一，它定义了:

1. 文档的层级结构
2. 导航菜单的显示顺序
3. 文件路径与标题的映射关系
4. 目录的索引页设置

系统根据这个文件生成左侧导航菜单，并通过它确定如何加载和显示文档内容。

## 文件结构

`path.json` 采用树形结构表示文档的层次关系，基本结构如下：

```json
{
    "title": "首页",
    "path": "",
    "index": {
        "title": "EasyDocument 文档中心",
        "path": "README.md"
    },
    "children": [
        // 子节点...
    ]
}
```

### 主要字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| `title` | 字符串 | 导航中显示的标题文本 |
| `path` | 字符串 | 文档相对路径：单分支时为相对于文档根目录；启用 `document.branch_support` 时为相对于该分支目录（如 `data/main/`），即不含分支名前缀 |
| `children` | 数组 | 子节点列表，每个子节点均为同结构对象 |
| `index` | 对象 | （可选）目录的索引页信息，包含 `title` 和 `path` |

## 节点类型

在 `path.json` 中，有两种主要的节点类型：

### 1. 目录节点

代表一个文档目录，通常包含 `index` 属性指向目录的介绍页（通常是 README.md）：

```json
{
    "title": "快速入门",
    "path": "快速入门",
    "index": {
        "title": "快速入门",
        "path": "快速入门/README.md"
    },
    "children": [
        // 该目录下的文档和子目录...
    ]
}
```

### 2. 文档节点

代表单个文档文件：

```json
{
    "title": "Markdown语法指南",
    "path": "快速入门/Markdown语法.md",
    "children": []
}
```

## 完整示例

以下是一个包含多级目录和文档的 `path.json` 示例：

```json
{
    "title": "首页",
    "path": "",
    "index": {
        "title": "EasyDocument 文档中心",
        "path": "README.md"
    },
    "children": [
        {
            "title": "快速入门",
            "path": "快速入门",
            "children": [
                {
                    "title": "Markdown语法指南",
                    "path": "快速入门/Markdown语法.md",
                    "children": []
                }
            ],
            "index": {
                "title": "快速入门",
                "path": "快速入门/README.md"
            }
        },
        {
            "title": "使用指南",
            "path": "使用指南",
            "children": [
                {
                    "title": "基本使用流程",
                    "path": "使用指南/基本使用流程.md",
                    "children": []
                },
                {
                    "title": "文档内链接",
                    "path": "使用指南/文档内链接.md",
                    "children": []
                },
                {
                    "title": "文档编写规范",
                    "path": "使用指南/文档编写规范.md",
                    "children": []
                }
            ],
            "index": {
                "title": "使用指南",
                "path": "使用指南/README.md"
            }
        }
    ]
}
```

## 手动编辑指南

### 编辑前的准备

1. 备份现有的 `path.json` 文件，防止意外损坏
2. 使用支持 JSON 格式的编辑器，如 VS Code，以获得语法高亮和格式检查
3. 确保理解文档的实际路径结构，避免指向不存在的文件

### 编辑步骤

1. **添加新目录**

   要添加新的文档目录，在相应父节点的 `children` 数组中添加一个新对象：

   ```json
   {
       "title": "新目录名称",
       "path": "新目录路径",
       "children": [],
       "index": {
           "title": "新目录介绍页标题",
           "path": "新目录路径/README.md"
       }
   }
   ```

2. **添加新文档**

   要添加新的文档，在相应目录节点的 `children` 数组中添加：

   ```json
   {
       "title": "文档标题",
       "path": "所属目录/文档文件名.md",
       "children": []
   }
   ```

3. **调整文档顺序**

   通过改变 `children` 数组中元素的顺序，可以调整导航菜单中文档的显示顺序。

4. **修改文档标题**

   如果需要在导航菜单中显示与文件名不同的标题，可以修改节点的 `title` 属性。

### 注意事项

1. **保持 JSON 格式有效**：确保所有引号、逗号和括号配对正确
2. **路径正确性**：`path` 字段必须与实际文件路径相匹配
3. **目录完整性**：每个目录节点应该有对应的 `index` 属性
4. **空 children 数组**：即使没有子节点，也需要保留空的 `children` 数组 `[]`
5. **避免循环引用**：确保不会创建导航结构中的循环

## 验证 path.json

编辑完成后，可以通过以下方式验证 `path.json` 的有效性：

1. 使用在线 JSON 验证工具检查格式是否正确
2. 打开 EasyDocument 网站，检查导航菜单是否正确显示
3. 点击导航项，确保可以正确加载文档内容

## 与 build.py 的关系

`build.py` 脚本会扫描 `/data` 目录并自动生成 `path.json` 文件。如果您手动编辑了 `path.json`，再次运行 `build.py` 将会覆盖您的修改。

在某些情况下，您可能需要：

1. **先自动生成，后手动调整**：运行 `build.py` 生成基本结构，然后手动微调
2. **保存自定义版本**：将手动编辑的版本保存为其他文件名（如 `path.custom.json`）
3. **修改构建流程**：调整 `build.py` 脚本以保留特定的自定义设置

## 故障排除

如果编辑 `path.json` 后导航不正常工作，请检查：

1. **JSON 语法错误**：确保没有缺少逗号、引号或大括号
2. **路径不存在**：确保所有 `path` 指向的文件确实存在
3. **重复节点**：检查是否有多个节点指向同一个文件
4. **特殊字符**：确保没有未正确处理的特殊字符

## 小结

手动编辑 `path.json` 可以提供对文档结构和导航的精确控制，尤其适用于需要特殊排序或分组的场景。理解并掌握 `path.json` 的结构，可以帮助您充分利用 EasyDocument 系统的灵活性。

## 相关文档

- [基本使用流程](使用指南/基本使用流程.md)
- [配置详解](配置详解/README.md) 