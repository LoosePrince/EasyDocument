# 构建工具与搜索功能

本文档介绍 EasyDocument 系统中的构建工具和搜索功能的使用方法。

## 构建工具 (build.py)

EasyDocument 提供了一个功能强大的 Python 构建工具 `build.py`，用于自动扫描文档目录并生成路径文件和搜索索引。

### 基本用法

```bash
python build.py [选项]
```

### 可用选项

| 选项 | 说明 |
|------|------|
| `--root DIRECTORY` | 指定文档根目录 (默认: data) |
| `--output FILE` | 指定输出的路径文件名 (默认: path.json) |
| `--pretty` | 美化输出的JSON格式，使用4个空格缩进 |
| `--extend` | 使用拓展模式，保留已有结构和排序 |
| `--search` | 同时生成搜索索引文件 |
| `--search-output FILE` | 指定搜索索引输出文件名 (默认: search.json) |

### 标准模式

标准模式会重新生成完整的路径文件，不保留任何自定义排序或结构：

```bash
python build.py --pretty
```

这将扫描 `data` 目录并生成 `path.json` 文件，使用4个空格缩进格式。

### 拓展模式

拓展模式允许你保留已有的文件结构、排序和自定义字段，这对于维护手动编辑过的 `path.json` 文件非常有用：

```bash
python build.py --extend --pretty
```

拓展模式的特点：

1. 保留现有文件和目录的排序
2. 保留自定义字段（如 `order`）
3. 更新文档标题（如果有变化）
4. 将新文件添加到相应目录的末尾
5. 自动移除不再存在的文件和目录

这使得你可以手动编辑 `path.json` 文件来创建自定义导航结构，而不必担心下次运行构建工具时会丢失这些更改。

### 搜索索引生成

要生成搜索索引文件，使用 `--search` 选项：

```bash
python build.py --pretty --search
```

这将生成 `search.json` 文件，其中包含文档标题、内容摘要和关键词索引。你也可以结合拓展模式使用：

```bash
python build.py --extend --pretty --search
```

搜索索引生成过程包括：

1. 提取每个文档的内容（移除标记、代码块等）
2. 自动分析并提取关键词
3. 生成内容摘要
4. 将所有信息保存到搜索索引文件

## 搜索功能

EasyDocument 内置了全文搜索功能，允许用户快速查找文档内容。

### 使用搜索

1. 点击顶栏右侧的搜索图标 <i class="fas fa-search"></i>
2. 在弹出的搜索模态窗口中输入关键词（至少2个字符）
3. 按下回车键或点击搜索按钮执行搜索
4. 查看搜索结果列表，点击感兴趣的条目跳转到相应文档

### 搜索结果展示

搜索结果包含以下信息：

- 文档标题（匹配部分高亮显示）
- 内容预览（匹配部分高亮显示，并显示上下文）
- 文档路径

### 搜索功能特点

- **实时搜索**：完全在前端执行，无需等待服务器响应
- **全文检索**：搜索文档标题、内容和关键词
- **智能匹配**：突出显示匹配的关键词并显示上下文
- **适配主题**：支持明暗两种主题模式

### 搜索索引更新

每次添加、修改或删除文档后，应该重新生成搜索索引，以确保搜索结果的准确性：

```bash
python build.py --extend --pretty --search
```

### 自定义搜索索引

在某些情况下，你可能需要自定义搜索索引生成过程。你可以：

1. 修改 `build.py` 中的 `extract_keywords` 函数来改进关键词提取算法
2. 调整 `extract_content` 函数以更好地处理特定格式的文档
3. 修改 `max_keywords` 和 `max_chars` 参数调整提取的关键词数量和内容长度

## 性能注意事项

- 对于大型文档库，搜索索引文件可能会变得很大，影响加载速度
- 考虑优化文档内容，移除不必要的内容以减小索引大小
- 对于非常大的文档库，可能不适应本项目的搜索功能，建议自行实现或考虑其它项目