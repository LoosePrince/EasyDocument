# 搜索与缓存功能

本文档介绍 EasyDocument 系统中的搜索和缓存功能。

## 搜索功能

EasyDocument 内置了全文搜索功能，允许用户快速查找文档内容。
详细配置请参考[搜索功能配置](?path=配置详解/搜索功能.md)

### 使用搜索

1. 点击顶栏右侧的搜索图标 <i class="fas fa-search"></i>
2. 在弹出的搜索模态窗口中输入关键词（至少2个字符）
3. 按下回车键或点击搜索按钮执行搜索
4. 查看搜索结果列表，点击感兴趣的条目跳转到相应文档

### 搜索结果展示

搜索结果包含以下信息：

- 文档标题（匹配部分高亮显示）
- 内容预览（匹配部分高亮显示，并显示上下文）
- 文档路径

### 搜索功能特点

- **实时搜索**：完全在前端执行，无需等待服务器响应
- **全文检索**：搜索文档标题、内容和关键词
- **智能匹配**：突出显示匹配的关键词并显示上下文
- **适配主题**：支持明暗两种主题模式

### 搜索索引更新

每次添加、修改或删除文档后，应该通过运行构建工具 (`build.py`) 重新生成搜索索引，以确保搜索结果的准确性：

```bash
python build.py --merge
```

### 缓存搜索

EasyDocument 的搜索功能现在支持搜索 **缓存** 和 **预加载** 的文档内容。这意味着：

- 您可以搜索最近访问过的文档（持久缓存）和系统自动预加载的文档（内存缓存）。
- 即使在离线状态下，只要文档在缓存中，也可以被搜索到。
- 搜索结果会明确标记哪些结果来自缓存或预加载。
  - <i class="fas fa-database text-blue-500"></i> 图标表示来自持久缓存（保留10分钟）。
  - <i class="fas fa-bolt text-purple-500"></i> 图标表示来自预加载缓存（刷新页面后丢失）。

此功能默认启用。您可以在 `config.js` 中通过 `search.search_cached` 选项控制是否搜索缓存内容。

### 自定义搜索索引

在某些情况下，你可能需要自定义搜索索引生成过程。你可以修改 `build.py` 中的相关函数：

1. `extract_keywords` 函数：控制关键词提取算法和最大关键词数量
2. `extract_content` 函数：处理文档内容提取及最大提取字符数
3. `build_search_tree` 函数：构建搜索索引数据结构

## 缓存管理器

EasyDocument 引入了缓存管理器，让您可以更直观地了解和控制文档的缓存状态。

### 访问缓存管理器

当您加载一个文档后，如果该文档是从缓存或预加载中获取的，页面右下角会出现一个状态指示器：

- <i class="fas fa-database text-blue-500"></i> **已缓存**: 表示文档来自持久缓存（10分钟内有效）。
- <i class="fas fa-bolt text-purple-500"></i> **预加载**: 表示文档来自内存预加载缓存（刷新后失效）。

点击这个状态指示器，即可打开缓存管理面板。

### 缓存管理面板功能

缓存管理面板提供以下功能：

- **查看状态**: 显示当前预加载文档和持久缓存文档的数量。
- **预加载文档列表**: 
    - 列出所有已预加载的文档路径。
    - 可以 **手动触发预加载**，系统会自动加载 `path.json` 中定义的文档（优先加载未缓存的）。
    - 可以 **清除所有预加载缓存** 或 **单个移除** 预加载文档。
- **持久缓存文档列表**: 
    - 列出所有在持久缓存中的文档路径及缓存时间（如"5分钟前"）。
    - 可以 **清除所有持久缓存** 或 **单个移除** 缓存文档。
- **说明信息**: 解释预加载和持久缓存的区别。

### 缓存机制说明

- **预加载**: 系统会在后台自动加载一些您可能接下来会访问的文档（基于 `path.json`），这些文档存储在内存中，访问速度快，但刷新页面后会丢失。
- **持久缓存**: 您访问过的文档会自动存储在浏览器的本地存储中，有效期为10分钟。即使刷新页面或关闭浏览器后重新打开（在10分钟内），这些文档也能快速加载。

缓存管理器为您提供了对这两种缓存的透明度和控制权。 